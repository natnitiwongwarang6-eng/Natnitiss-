<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Card Generator</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@400;500;600;700&display=swap');
body { 
  font-family: 'Noto Sans Lao', sans-serif; 
  width: 100%;
  height: auto;
  min-height: 100vh;
}
.print-area { background: white !important; }
@media print {
  body * { visibility: hidden; }
  .print-area, .print-area * { visibility: visible; }
  .print-area { position: absolute; left: 0; top: 0; width: 100%; }
  .no-print { display: none !important; }
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// Fixed QR Code - ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå QR Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏ä‡πà‡∏ô 'qrcode.png')
const QR_CODE_FILENAME = 'quality_restoration_25680916165413506.jpeg';
const FIXED_QR_CODE = `${QR_CODE_FILENAME}`;

// --- Encode/Decode Unicode Base64 URL-safe ---
const encodeData = (data) => {
  const json = JSON.stringify(data);
  const bytes = new TextEncoder().encode(json);
  let binary = '';
  for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
  return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
};

const decodeData = (encodedData) => {
  try {
    let base64 = encodedData.replace(/-/g, '+').replace(/_/g, '/');
    const pad = base64.length % 4;
    if (pad) base64 += '===='.slice(pad);
    const binary = atob(base64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
    const json = new TextDecoder().decode(bytes);
    return JSON.parse(json);
  } catch { return null; }
};

const formatPrice = (price) => new Intl.NumberFormat('en-US').format(price);

// Generate unique order number
const generateOrderNumber = () => {
  const randomNum = Math.floor(Math.random() * 90000) + 10000; // Generate 5-digit number (10000-99999)
  return `Natniti${randomNum}`;
};

// Order Form
const OrderForm = ({ items, setItems, orderNumber, generateNewOrderNumber }) => {
  const [itemName, setItemName] = useState('');
  const [quantity, setQuantity] = useState('');
  const [price, setPrice] = useState('');
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [showQuantityModal, setShowQuantityModal] = useState(false);
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [modalQuantity, setModalQuantity] = useState('1');
  const [showProductManager, setShowProductManager] = useState(false);
  const [newProductName, setNewProductName] = useState('');
  const [newProductPrice, setNewProductPrice] = useState('');
  const [editingProduct, setEditingProduct] = useState(null);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [productToDelete, setProductToDelete] = useState(null);

  // Load products from localStorage or use defaults
  const getStoredProducts = () => {
    const stored = localStorage.getItem('quickProducts');
    if (stored) {
      return JSON.parse(stored);
    }
    return [
      { id: 1, name: '‡ªÄ‡∫ö‡∫ç‡∫•‡∫≤‡∫ß', price: 12000 },
      { id: 2, name: '‡∫ô‡ªâ‡∫≥‡∫î‡∫∑‡ªà‡∫°', price: 3000 },
      { id: 3, name: '‡∫°‡∫≤‡∫°‡ªà‡∫≤', price: 2500 },
      { id: 4, name: '‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫à‡∫µ‡ªà', price: 15000 },
      { id: 5, name: '‡∫Å‡∫≤‡ªÄ‡∫ü', price: 8000 },
      { id: 6, name: '‡∫ô‡∫ª‡∫°‡∫™‡∫ª‡∫î', price: 6000 },
      { id: 7, name: '‡∫Ç‡∫∞‡ªú‡∫ª‡∫°‡∫õ‡∫±‡∫á', price: 4000 },
      { id: 8, name: '‡ªÑ‡∫Ç‡ªà‡ªÑ‡∫Å‡ªà', price: 1500 },
      { id: 9, name: '‡∫ô‡ªâ‡∫≥‡∫ï‡∫≤‡∫ô', price: 5000 },
      { id: 10, name: '‡∫ö‡∫¥‡∫™‡∫Å‡∫¥‡∫î', price: 3500 }
    ];
  };

  const [predefinedProducts, setPredefinedProducts] = useState(getStoredProducts);

  // Save products to localStorage
  const saveProducts = (products) => {
    localStorage.setItem('quickProducts', JSON.stringify(products));
    setPredefinedProducts(products);
  };

  // Add new product
  const addNewProduct = () => {
    if (newProductName && newProductPrice) {
      const newProduct = {
        id: Date.now(),
        name: newProductName,
        price: parseFloat(newProductPrice)
      };
      const updatedProducts = [...predefinedProducts, newProduct];
      saveProducts(updatedProducts);
      setNewProductName('');
      setNewProductPrice('');
    }
  };

  // Edit product
  const startEditProduct = (product) => {
    setEditingProduct(product);
    setNewProductName(product.name);
    setNewProductPrice(product.price.toString());
  };

  const saveEditProduct = () => {
    if (editingProduct && newProductName && newProductPrice) {
      const updatedProducts = predefinedProducts.map(p => 
        p.id === editingProduct.id 
          ? { ...p, name: newProductName, price: parseFloat(newProductPrice) }
          : p
      );
      saveProducts(updatedProducts);
      setEditingProduct(null);
      setNewProductName('');
      setNewProductPrice('');
    }
  };

  const cancelEdit = () => {
    setEditingProduct(null);
    setNewProductName('');
    setNewProductPrice('');
  };

  // Delete product
  const deleteProduct = (product) => {
    setProductToDelete(product);
    setShowDeleteModal(true);
  };

  const confirmDelete = () => {
    if (productToDelete) {
      const updatedProducts = predefinedProducts.filter(p => p.id !== productToDelete.id);
      saveProducts(updatedProducts);
      setShowDeleteModal(false);
      setProductToDelete(null);
    }
  };

  const cancelDelete = () => {
    setShowDeleteModal(false);
    setProductToDelete(null);
  };

  const addItem = () => {
    if(itemName && quantity && price){
      setItems([...items, { 
        id: Date.now(), 
        name: itemName, 
        quantity: parseInt(quantity), 
        price: parseFloat(price) 
      }]);
      setItemName(''); setQuantity(''); setPrice('');
    }
  };

  const addPredefinedItem = (product) => {
    setSelectedProduct(product);
    setShowQuantityModal(true);
    setShowSuggestions(false);
  };

  const confirmAddItem = () => {
    if (selectedProduct && modalQuantity) {
      setItems([...items, {
        id: Date.now(),
        name: selectedProduct.name,
        quantity: parseInt(modalQuantity),
        price: selectedProduct.price
      }]);
      setShowQuantityModal(false);
      setSelectedProduct(null);
      setModalQuantity('1');
    }
  };

  const removeItem = (id) => {
    setItems(items.filter(item => item.id !== id));
  };

  const filteredProducts = predefinedProducts.filter(product =>
    product.name.toLowerCase().includes(itemName.toLowerCase())
  );

  return (
    <div className="bg-white p-6 rounded-lg shadow-lg">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-gray-800">‡∫™‡ªâ‡∫≤‡∫á‡ªÉ‡∫ö‡∫™‡∫±‡ªà‡∫á‡∫ä‡∫∑‡ªâ</h2>
        <div className="text-right">
          <p className="text-sm text-gray-600">‡ªÄ‡∫•‡∫Å‡∫ó‡∫µ‡ªÉ‡∫ö‡∫™‡∫±‡ªà‡∫á</p>
          <p className="text-xl font-bold text-blue-600">#{orderNumber}</p>
          <button
            onClick={generateNewOrderNumber}
            className="text-xs text-blue-500 hover:text-blue-700 underline mt-1"
          >
            ‡∫™‡ªâ‡∫≤‡∫á‡ªÄ‡∫•‡∫Å‡ªÉ‡ªù‡ªà
          </button>
        </div>
      </div>

      {/* Add Items */}
      <div className="mb-6 space-y-4">
        <h3 className="text-lg font-semibold text-gray-700">‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤</h3>
        
        {/* Quick Add Buttons */}
        <div className="mb-4 flex gap-2 flex-wrap">
          <button
            onClick={() => setShowSuggestions(!showSuggestions)}
            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors"
          >
            {showSuggestions ? '‡∫õ‡∫¥‡∫î‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤' : '‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫î‡ªà‡∫ß‡∫ô'}
          </button>
          <button
            onClick={() => setShowProductManager(!showProductManager)}
            className="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors"
          >
            {showProductManager ? '‡∫õ‡∫¥‡∫î‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤' : '‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫î‡ªà‡∫ß‡∫ô'}
          </button>
        </div>

        {/* Product Manager */}
        {showProductManager && (
          <div className="bg-gray-50 p-4 rounded-lg mb-4">
            <h4 className="font-semibold text-gray-700 mb-3">‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤‡∫î‡ªà‡∫ß‡∫ô</h4>
            
            {/* Add/Edit Product Form */}
            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
              <input
                type="text"
                placeholder="‡∫ä‡∫∑‡ªà‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤"
                value={newProductName}
                onChange={(e) => setNewProductName(e.target.value)}
                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <input
                type="number"
                placeholder="‡∫•‡∫≤‡∫Ñ‡∫≤ (‡∫Å‡∫µ‡∫ö)"
                value={newProductPrice}
                onChange={(e) => setNewProductPrice(e.target.value)}
                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
              <div className="flex gap-2">
                {editingProduct ? (
                  <>
                    <button
                      onClick={saveEditProduct}
                      className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex-1"
                    >
                      ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å
                    </button>
                    <button
                      onClick={cancelEdit}
                      className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors"
                    >
                      ‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å
                    </button>
                  </>
                ) : (
                  <button
                    onClick={addNewProduct}
                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex-1"
                  >
                    ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤
                  </button>
                )}
              </div>
            </div>

            {/* Products List */}
            <div className="space-y-2 max-h-60 overflow-y-auto">
              {predefinedProducts.map((product) => (
                <div key={product.id} className="flex justify-between items-center bg-white p-3 rounded-lg border">
                  <div>
                    <span className="font-medium">{product.name}</span>
                    <span className="text-gray-600 ml-2">{formatPrice(product.price)} ‡∫Å‡∫µ‡∫ö</span>
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => startEditProduct(product)}
                      className="text-blue-500 hover:text-blue-700 text-sm px-2 py-1 rounded transition-colors"
                    >
                      ‡ªÅ‡∫Å‡ªâ‡ªÑ‡∫Ç
                    </button>
                    <button
                      onClick={() => deleteProduct(product)}
                      className="text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded transition-colors"
                    >
                      ‡∫•‡∫∂‡∫ö
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {showSuggestions && (
          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 mb-4">
            {predefinedProducts.map((product) => (
              <button
                key={product.id}
                onClick={() => addPredefinedItem(product)}
                className="bg-blue-100 hover:bg-blue-200 text-blue-800 px-3 py-2 rounded-lg text-sm transition-colors"
              >
                {product.name}<br/>
                <span className="text-xs">{formatPrice(product.price)} ‡∫Å‡∫µ‡∫ö</span>
              </button>
            ))}
          </div>
        )}

        {/* Manual Add Form */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="relative">
            <input
              type="text"
              placeholder="‡∫ä‡∫∑‡ªà‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤"
              value={itemName}
              onChange={(e) => {
                setItemName(e.target.value);
                setShowSuggestions(false);
              }}
              className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
            {itemName && filteredProducts.length > 0 && (
              <div className="absolute z-10 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-40 overflow-y-auto">
                {filteredProducts.map((product, index) => (
                  <button
                    key={index}
                    onClick={() => {
                      setItemName(product.name);
                      setPrice(product.price);
                    }}
                    className="w-full text-left px-4 py-2 hover:bg-gray-100 flex justify-between"
                  >
                    <span>{product.name}</span>
                    <span className="text-gray-500">{formatPrice(product.price)} ‡∫Å‡∫µ‡∫ö</span>
                  </button>
                ))}
              </div>
            )}
          </div>
          <input
            type="number"
            placeholder="‡∫à‡∫≥‡∫ô‡∫ß‡∫ô"
            value={quantity}
            onChange={(e) => setQuantity(e.target.value)}
            className="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
          <input
            type="number"
            placeholder="‡∫•‡∫≤‡∫Ñ‡∫≤ (‡∫Å‡∫µ‡∫ö)"
            value={price}
            onChange={(e) => setPrice(e.target.value)}
            className="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
          <button
            onClick={addItem}
            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"
          >
            ‡ªÄ‡∫û‡∫µ‡ªà‡∫°
          </button>
        </div>
      </div>

      {/* Items List */}
      {items.length > 0 && (
        <div className="mb-6">
          <h3 className="text-lg font-semibold text-gray-700 mb-4">‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤</h3>
          <div className="space-y-2">
            {items.map((item) => (
              <div key={item.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                <div>
                  <span className="font-medium">{item.name}</span>
                  <span className="text-gray-600 ml-2">x{item.quantity}</span>
                </div>
                <div className="flex items-center space-x-3">
                  <span className="font-semibold">{formatPrice(item.price * item.quantity)} ‡∫Å‡∫µ‡∫ö</span>
                  <button
                    onClick={() => removeItem(item.id)}
                    className="text-red-500 hover:text-red-700 transition-colors"
                  >
                    ‚úï
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Quantity Modal */}
      {showQuantityModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg shadow-xl">
            <h3 className="text-lg font-semibold mb-4">‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫à‡∫≥‡∫ô‡∫ß‡∫ô: {selectedProduct?.name}</h3>
            <div className="mb-4">
              <input
                type="number"
                value={modalQuantity}
                onChange={(e) => setModalQuantity(e.target.value)}
                className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                min="1"
              />
            </div>
            <div className="flex space-x-3">
              <button
                onClick={confirmAddItem}
                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"
              >
                ‡ªÄ‡∫û‡∫µ‡ªà‡∫°
              </button>
              <button
                onClick={() => setShowQuantityModal(false)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors"
              >
                ‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Delete Confirmation Modal */}
      {showDeleteModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-4">
            <div className="text-center">
              <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center">
                <span className="text-2xl text-red-600">‚ö†Ô∏è</span>
              </div>
              <h3 className="text-lg font-semibold mb-2 text-gray-800">‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö</h3>
              <p className="text-gray-600 mb-6">
                ‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô‡∫•‡∫∂‡∫ö‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤ "<span className="font-semibold">{productToDelete?.name}</span>" ‡ªÅ‡∫ó‡ªâ‡∫ö‡ªç?
              </p>
              <div className="flex space-x-3 justify-center">
                <button
                  onClick={confirmDelete}
                  className="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                  ‡∫•‡∫∂‡∫ö
                </button>
                <button
                  onClick={cancelDelete}
                  className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                  ‡∫ç‡∫ª‡∫Å‡ªÄ‡∫•‡∫µ‡∫Å
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// Order Card Component - Receipt Style
const OrderCard = ({ items, orderNumber }) => {
  const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const currentDate = new Date().toLocaleDateString('lo-LA');
  const currentTime = new Date().toLocaleTimeString('lo-LA', { hour: '2-digit', minute: '2-digit' });

  return (
    <div class="print-area bg-white p-6 rounded-lg shadow-lg w-full max-w-full border-2 border-gray-200">
      {/* Header */}
      <div className="text-center mb-4 border-b-2 border-dashed border-gray-300 pb-4">
        <h1 className="text-xl font-bold text-gray-800 mb-1">‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö / RECEIPT</h1>
        <div className="text-sm text-gray-600">
          <p>‡∫ß‡∫±‡∫ô‡∫ó‡∫µ: {currentDate}</p>
          <p>‡ªÄ‡∫ß‡∫•‡∫≤: {currentTime}</p>
        </div>
      </div>

      {/* QR Code Section */}
      <div className="text-center mb-4">
        <div className="bg-white p-3 rounded-lg border-2 border-dashed border-gray-400 mb-3">
          <p className="text-sm text-gray-600 mb-2">‡∫™‡∫∞‡ªÅ‡∫Å‡∫ô‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡ªÇ‡∫≠‡∫ô‡ªÄ‡∫á‡∫¥‡∫ô</p>
          <img 
            src={FIXED_QR_CODE} 
            alt="QR Code for payment" 
            className="w-32 h-32 mx-auto border border-gray-300 rounded"
            onError="this.style.display='none'; this.nextElementSibling.style.display='block';"
          />
          <div className="w-32 h-32 mx-auto border border-gray-300 rounded bg-gray-100 flex items-center justify-center text-gray-500 text-xs" style="display: none;">
            QR Code<br/>‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡ªÇ‡∫´‡∫•‡∫î‡ªÑ‡∫î‡ªâ
          </div>
        </div>
      </div>

      {/* Order Number */}
      <div className="text-center mb-4">
        <div className="bg-gray-100 rounded-lg p-3 border-2 border-dashed border-gray-400">
          <p className="text-sm text-gray-600 mb-1">‡ªÄ‡∫•‡∫Å‡∫ó‡∫µ‡ªÉ‡∫ö‡∫™‡∫±‡ªà‡∫á</p>
          <p className="text-2xl font-bold text-blue-600">#{orderNumber}</p>
        </div>
      </div>

      {/* Items Table */}
      <div className="mb-4">
        <div className="border-b-2 border-gray-300 pb-2 mb-3">
          <div className="grid grid-cols-12 gap-1 text-xs font-semibold text-gray-700">
            <div className="col-span-6">‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô</div>
            <div className="col-span-2 text-center">‡∫à‡∫≥‡∫ô‡∫ß‡∫ô</div>
            <div className="col-span-2 text-right">‡∫•‡∫≤‡∫Ñ‡∫≤</div>
            <div className="col-span-2 text-right">‡∫•‡∫ß‡∫°</div>
          </div>
        </div>
        
        {items.length === 0 ? (
          <p className="text-gray-500 text-center py-4 text-sm">‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫™‡∫¥‡∫ô‡∫Ñ‡ªâ‡∫≤</p>
        ) : (
          <div className="space-y-2">
            {items.map((item, index) => (
              <div key={item.id} className="grid grid-cols-12 gap-1 text-sm py-1 border-b border-gray-200">
                <div className="col-span-6">
                  <span className="font-medium">{item.name}</span>
                </div>
                <div className="col-span-2 text-center">{item.quantity}</div>
                <div className="col-span-2 text-right">{formatPrice(item.price)}</div>
                <div className="col-span-2 text-right font-semibold">{formatPrice(item.price * item.quantity)}</div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Total Section */}
      {items.length > 0 && (
        <div className="border-t-2 border-dashed border-gray-300 pt-3">
          <div className="flex justify-between items-center mb-2">
            <span className="text-sm text-gray-600">‡∫•‡∫ß‡∫°‡∫ç‡ªà‡∫≠‡∫ç:</span>
            <span className="font-semibold">{formatPrice(total)} ‡∫Å‡∫µ‡∫ö</span>
          </div>
          <div className="flex justify-between items-center text-lg font-bold bg-gray-100 p-2 rounded">
            <span>‡∫•‡∫ß‡∫°‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î:</span>
            <span className="text-blue-600">{formatPrice(total)} ‡∫Å‡∫µ‡∫ö</span>
          </div>
        </div>
      )}

      {/* Footer */}
      <div className="mt-4 text-center border-t-2 border-dashed border-gray-300 pt-3">
        <p className="text-xs text-gray-500 mb-2">‡∫Ç‡∫≠‡∫ö‡ªÉ‡∫à‡∫ó‡∫µ‡ªà‡ªÉ‡∫ä‡ªâ‡∫ö‡ªç‡∫•‡∫¥‡∫Å‡∫≤‡∫ô</p>
        <div className="text-xs text-gray-400">
          <p>*** ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡ªÄ‡∫Å‡∫±‡∫ö‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö‡ªÑ‡∫ß‡ªâ ***</p>
        </div>
      </div>
    </div>
  );
};

// Main App
const App = () => {
  const [items, setItems] = useState([]);
  const [activeTab, setActiveTab] = useState('form');
  const [orderNumber, setOrderNumber] = useState(() => generateOrderNumber());

  const generateNewOrderNumber = () => {
    setOrderNumber(generateOrderNumber());
  };

  // Load data from URL on mount
  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('data');
    if (data) {
      const decoded = decodeData(data);
      if (decoded) {
        setItems(decoded.items || []);
        setOrderNumber(decoded.orderNumber || generateOrderNumber());
        setActiveTab('card');
      }
    }
  }, []);

  const [showModal, setShowModal] = useState(false);
  const [modalMessage, setModalMessage] = useState('');
  const [modalType, setModalType] = useState('success');

  const generateShareableLink = () => {
    const data = { items, orderNumber };
    const encoded = encodeData(data);
    const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
    navigator.clipboard.writeText(url);
    setModalMessage('‡∫•‡∫¥‡ªâ‡∫á‡ªÑ‡∫î‡ªâ‡∫ñ‡∫∑‡∫Å‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡ªÅ‡∫•‡ªâ‡∫ß!');
    setModalType('success');
    setShowModal(true);
  };

  const shareImage = async () => {
    const element = document.querySelector('.print-area');
    if (element) {
      const canvas = await html2canvas(element, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        allowTaint: true,
        foreignObjectRendering: true
      });
      
      // Convert canvas to blob
      canvas.toBlob(async (blob) => {
        if (navigator.share && navigator.canShare) {
          const file = new File([blob], `receipt-${orderNumber}.png`, { type: 'image/png' });
          
          if (navigator.canShare({ files: [file] })) {
            try {
              await navigator.share({
                title: `‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö #${orderNumber}`,
                text: '‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö‡∫à‡∫≤‡∫Å‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫°‡∫∑‡∫™‡ªâ‡∫≤‡∫á‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö',
                files: [file]
              });
              setModalMessage('‡ªÅ‡∫ä‡∫£‡πå‡∫Æ‡∫π‡∫ö‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!');
              setModalType('success');
              setShowModal(true);
            } catch (error) {
              if (error.name !== 'AbortError') {
                // Fallback to download
                const link = document.createElement('a');
                link.download = `receipt-${orderNumber}.png`;
                link.href = canvas.toDataURL();
                link.click();
                setModalMessage('‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫•‡∫î‡∫Æ‡∫π‡∫ö‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!');
                setModalType('success');
                setShowModal(true);
              }
            }
          } else {
            // Fallback to download
            const link = document.createElement('a');
            link.download = `receipt-${orderNumber}.png`;
            link.href = canvas.toDataURL();
            link.click();
            setModalMessage('‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫•‡∫î‡∫Æ‡∫π‡∫ö‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!');
            setModalType('success');
            setShowModal(true);
          }
        } else {
          // Fallback to download
          const link = document.createElement('a');
          link.download = `receipt-${orderNumber}.png`;
          link.href = canvas.toDataURL();
          link.click();
          setModalMessage('‡∫î‡∫≤‡∫ß‡ªÇ‡∫´‡∫•‡∫î‡∫Æ‡∫π‡∫ö‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î‡ªÅ‡∫•‡ªâ‡∫ß!');
          setModalType('success');
          setShowModal(true);
        }
      }, 'image/png');
    }
  };

  const printCard = () => {
    window.print();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8">
      <div className="container mx-auto px-4 max-w-full">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-gray-800 mb-2">‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á‡∫°‡∫∑‡∫™‡ªâ‡∫≤‡∫á‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö</h1>
          <p className="text-gray-600">‡∫™‡ªâ‡∫≤‡∫á‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö‡∫ó‡∫µ‡ªà‡∫™‡∫ß‡∫ç‡∫á‡∫≤‡∫°‡ªÅ‡∫•‡∫∞‡∫°‡∫∑‡∫≠‡∫≤‡∫ä‡∫µ‡∫ö</p>
        </div>

        {/* Tab Navigation */}
        <div className="flex justify-center mb-8 no-print">
          <div className="bg-white rounded-lg p-1 shadow-lg">
            <button
              onClick={() => setActiveTab('form')}
              className={`px-6 py-2 rounded-md transition-colors ${
                activeTab === 'form' 
                  ? 'bg-blue-500 text-white' 
                  : 'text-gray-600 hover:text-blue-500'
              }`}
            >
              ‡ªÅ‡∫ö‡∫ö‡∫ü‡∫≠‡∫°
            </button>
            <button
              onClick={() => setActiveTab('card')}
              className={`px-6 py-2 rounded-md transition-colors ${
                activeTab === 'card' 
                  ? 'bg-blue-500 text-white' 
                  : 'text-gray-600 hover:text-blue-500'
              }`}
            >
              ‡ªÉ‡∫ö‡ªÄ‡∫™‡∫±‡∫ö
            </button>
          </div>
        </div>

        <div className="max-w-4xl mx-auto w-full">
          {activeTab === 'form' ? (
            <div className="w-full">
              <OrderForm 
                items={items} 
                setItems={setItems}
                orderNumber={orderNumber}
                generateNewOrderNumber={generateNewOrderNumber}
              />
            </div>
          ) : (
            <div className="w-full">
              <OrderCard items={items} orderNumber={orderNumber} />
              
              {/* Action Buttons */}
              <div className="flex flex-wrap justify-center gap-4 mt-8 no-print">
                <button
                  onClick={generateShareableLink}
                  className="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                  üìã ‡∫Ñ‡∫±‡∫î‡∫•‡∫≠‡∫Å‡∫•‡∫¥‡ªâ‡∫á
                </button>
                <button
                  onClick={shareImage}
                  className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                  üì§ ‡ªÅ‡∫ä‡∫£‡πå‡∫Æ‡∫π‡∫ö
                </button>
                <button
                  onClick={printCard}
                  className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                  üñ®Ô∏è ‡∫û‡∫¥‡∫°
                </button>
              </div>
            </div>
          )}
        </div>

        {/* Modal */}
        {showModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
            <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-4">
              <div className="text-center">
                <div className={`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${
                  modalType === 'success' ? 'bg-green-100' : 'bg-red-100'
                }`}>
                  <span className={`text-2xl ${
                    modalType === 'success' ? 'text-green-600' : 'text-red-600'
                  }`}>
                    {modalType === 'success' ? '‚úì' : '‚úï'}
                  </span>
                </div>
                <h3 className="text-lg font-semibold mb-2 text-gray-800">
                  {modalType === 'success' ? '‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î!' : '‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î!'}
                </h3>
                <p className="text-gray-600 mb-6">{modalMessage}</p>
                <button
                  onClick={() => setShowModal(false)}
                  className={`px-6 py-2 rounded-lg text-white transition-colors ${
                    modalType === 'success' 
                      ? 'bg-green-500 hover:bg-green-600' 
                      : 'bg-red-500 hover:bg-red-600'
                  }`}
                >
                  ‡∫ï‡∫ª‡∫Å‡∫•‡∫ª‡∫á
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983e2d4441490701',t:'MTc1ODY3Mzg2NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
